{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/alexm/VsCodeProjects/School Projects/CEN/SWE semester project/OnTask/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/alexm/VsCodeProjects/School Projects/CEN/SWE semester project/OnTask/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/alexm/VsCodeProjects/School Projects/CEN/SWE semester project/OnTask/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/alexm/VsCodeProjects/School Projects/CEN/SWE semester project/OnTask/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState}from\"react\";import{useEventsContext}from\"../hooks/useEventsContext\";import{useAuthContext}from'../hooks/useAuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EventForm=function EventForm(_ref){var fetchEvents=_ref.fetchEvents;var _useEventsContext=useEventsContext(),dispatch=_useEventsContext.dispatch;var _useAuthContext=useAuthContext(),user=_useAuthContext.user;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),date=_useState4[0],setDate=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),startTime=_useState6[0],setStartTime=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),endTime=_useState8[0],setEndTime=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),error=_useState10[0],setError=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),emptyFields=_useState12[0],setEmptyFields=_useState12[1];var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var start,end,event,response,json,_json;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(user){_context.next=4;break;}setError('You must be logged in');return _context.abrupt(\"return\");case 4:if(!(!date||!startTime||!endTime)){_context.next=7;break;}setError('Please fill in all fields');return _context.abrupt(\"return\");case 7:// Combine date and time into a single datetime string\nstart=new Date(\"\".concat(date,\"T\").concat(startTime,\"Z\"));end=new Date(\"\".concat(date,\"T\").concat(endTime,\"Z\"));// Check if the dates are valid\nif(!(isNaN(start.getTime())||isNaN(end.getTime()))){_context.next=12;break;}setError('Invalid date or time provided');return _context.abrupt(\"return\");case 12:// Convert to UTC before sending to the server\nevent={text:text,start:start.toISOString(),// This will be in UTC\nend:end.toISOString(),// This will be in UTC\nuser_id:user.id// Ensure your event model accepts user_id\n};console.log(\"Sending event:\",event);_context.prev=14;_context.next=17;return fetch('/api/events',{method:'POST',body:JSON.stringify(event),headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(user.token)// Ensure user.token is defined\n}});case 17:response=_context.sent;if(response.ok){_context.next=27;break;}_context.next=21;return response.json();case 21:json=_context.sent;// Attempt to parse the JSON\nsetError(json.error||'Something went wrong');// Provide a fallback error message\nsetEmptyFields(json.emptyFields||[]);// Ensure emptyFields is defined\nconsole.log(\"Error:\",json.error);_context.next=39;break;case 27:_context.next=29;return response.json();case 29:_json=_context.sent;// Parse JSON if the response is OK\nsetText('');setDate('');setStartTime('');setEndTime('');setError(null);setEmptyFields([]);console.log(\"Event dispatched:\",_json);dispatch({type:'CREATE_EVENT',payload:_objectSpread(_objectSpread({},_json),{},{id:_json._id})});fetchEvents();case 39:_context.next=45;break;case 41:_context.prev=41;_context.t0=_context[\"catch\"](14);console.error('Fetch error:',_context.t0);// Log any network errors\nsetError('An error occurred while creating the event.');case 45:case\"end\":return _context.stop();}}},_callee,null,[[14,41]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"form\",{className:\"create\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Add a New Event\"}),/*#__PURE__*/_jsx(\"label\",{children:\"Event Title:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",onChange:function onChange(e){return setText(e.target.value);},value:text,className:emptyFields.includes('text')?'error':''}),/*#__PURE__*/_jsx(\"label\",{children:\"Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",onChange:function onChange(e){return setDate(e.target.value);},value:date,className:emptyFields.includes('date')?'error':''}),/*#__PURE__*/_jsx(\"label\",{children:\"Start Time:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",onChange:function onChange(e){return setStartTime(e.target.value);},value:startTime,className:emptyFields.includes('startTime')?'error':''}),/*#__PURE__*/_jsx(\"label\",{children:\"End Time:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",onChange:function onChange(e){return setEndTime(e.target.value);},value:endTime,className:emptyFields.includes('endTime')?'error':''}),/*#__PURE__*/_jsx(\"button\",{children:\"Add Event\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error})]});};export default EventForm;","map":{"version":3,"names":["useState","useEventsContext","useAuthContext","EventForm","fetchEvents","dispatch","user","text","setText","date","setDate","startTime","setStartTime","endTime","setEndTime","error","setError","emptyFields","setEmptyFields","handleSubmit","e","preventDefault","start","Date","end","isNaN","getTime","event","toISOString","user_id","id","console","log","fetch","method","body","JSON","stringify","headers","token","response","ok","json","type","payload","_id","target","value","includes"],"sources":["C:/Users/alexm/VsCodeProjects/School Projects/CEN/SWE semester project/OnTask/frontend/src/components/CalendarForm.js"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useEventsContext } from \"../hooks/useEventsContext\";\r\nimport { useAuthContext } from '../hooks/useAuthContext';\r\n\r\nconst EventForm = ({ fetchEvents }) => {\r\n  const { dispatch } = useEventsContext();\r\n  const { user } = useAuthContext();\r\n\r\n  const [text, setText] = useState('');\r\n  const [date, setDate] = useState('');\r\n  const [startTime, setStartTime] = useState('');\r\n  const [endTime, setEndTime] = useState('');\r\n  const [error, setError] = useState(null);\r\n  const [emptyFields, setEmptyFields] = useState([]);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n  \r\n    if (!user) {\r\n      setError('You must be logged in');\r\n      return;\r\n    }\r\n  \r\n    if (!date || !startTime || !endTime) {\r\n      setError('Please fill in all fields');\r\n      return;\r\n    }\r\n  \r\n    // Combine date and time into a single datetime string\r\n    const start = new Date(`${date}T${startTime}Z`);\r\n    const end = new Date(`${date}T${endTime}Z`);\r\n    \r\n    // Check if the dates are valid\r\n    if (isNaN(start.getTime()) || isNaN(end.getTime())) {\r\n      setError('Invalid date or time provided');\r\n      return;\r\n    }\r\n  \r\n    // Convert to UTC before sending to the server\r\n    const event = { \r\n      text,\r\n      start: start.toISOString(),  // This will be in UTC\r\n      end: end.toISOString(),      // This will be in UTC\r\n      user_id: user.id // Ensure your event model accepts user_id\r\n    };\r\n  \r\n    console.log(\"Sending event:\", event);\r\n  \r\n    try {\r\n      const response = await fetch('/api/events', {\r\n        method: 'POST',\r\n        body: JSON.stringify(event),\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${user.token}`, // Ensure user.token is defined\r\n        },\r\n      });\r\n  \r\n      // Handle the response\r\n      if (!response.ok) {\r\n        const json = await response.json(); // Attempt to parse the JSON\r\n        setError(json.error || 'Something went wrong'); // Provide a fallback error message\r\n        setEmptyFields(json.emptyFields || []); // Ensure emptyFields is defined\r\n        console.log(\"Error:\", json.error);\r\n      } else {\r\n        const json = await response.json(); // Parse JSON if the response is OK\r\n        setText('');\r\n        setDate('');\r\n        setStartTime('');\r\n        setEndTime('');\r\n        setError(null);\r\n        setEmptyFields([]);\r\n        console.log(\"Event dispatched:\", json);\r\n        dispatch({ type: 'CREATE_EVENT', payload: { ...json, id: json._id } });\r\n        fetchEvents();\r\n      }\r\n    } catch (error) {\r\n      console.error('Fetch error:', error); // Log any network errors\r\n      setError('An error occurred while creating the event.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form className=\"create\" onSubmit={handleSubmit}>\r\n      <h3>Add a New Event</h3>\r\n\r\n      <label>Event Title:</label>\r\n      <input \r\n        type=\"text\"\r\n        onChange={(e) => setText(e.target.value)}\r\n        value={text}\r\n        className={emptyFields.includes('text') ? 'error' : ''}\r\n      />\r\n\r\n      <label>Date:</label>\r\n      <input \r\n        type=\"date\"\r\n        onChange={(e) => setDate(e.target.value)}\r\n        value={date}\r\n        className={emptyFields.includes('date') ? 'error' : ''}\r\n      />\r\n\r\n      <label>Start Time:</label>\r\n      <input \r\n        type=\"time\"\r\n        onChange={(e) => setStartTime(e.target.value)}\r\n        value={startTime}\r\n        className={emptyFields.includes('startTime') ? 'error' : ''}\r\n      />\r\n\r\n      <label>End Time:</label>\r\n      <input \r\n        type=\"time\"\r\n        onChange={(e) => setEndTime(e.target.value)}\r\n        value={endTime}\r\n        className={emptyFields.includes('endTime') ? 'error' : ''}\r\n      />\r\n\r\n      <button>Add Event</button>\r\n      {error && <div className=\"error\">{error}</div>}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default EventForm;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}