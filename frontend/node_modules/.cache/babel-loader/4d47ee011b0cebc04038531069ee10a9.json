{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\alexm\\\\VsCodeProjects\\\\School Projects\\\\CEN\\\\SWE semester project\\\\SWE-OnTask\\\\frontend\\\\src\\\\components\\\\ClassroomForm.js\",\n    _s = $RefreshSig$();\n\nimport { useState } from \"react\";\nimport { useClassContext } from \"../hooks/useClassContext\";\nimport { useAuthContext } from '../hooks/useAuthContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst ClassroomForm = () => {\n  _s();\n\n  const {\n    dispatch\n  } = useClassContext();\n  const {\n    user\n  } = useAuthContext();\n  const [email, setEmail] = useState(user.email);\n  const [code, setCode] = useState('');\n  const [classroomName, setClassroomName] = useState('');\n  const [error, setError] = useState(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n\n    if (!user) {\n      setError('You must be logged in');\n      return;\n    } // Validate form fields\n\n\n    if (!classroomName || !code || !email) {\n      setError('Please fill in all fields');\n      return;\n    }\n\n    try {\n      // Check if class code already exists\n      const codeExistsResponse = await fetch(`/api/classes/check-code?code=${code}`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${user.token}`\n        }\n      });\n\n      if (!codeExistsResponse.ok) {\n        const json = await codeExistsResponse.json();\n        setError(json.error || 'Class code is already taken');\n        return; // Prevent further execution if code exists\n      } // First, try to create the classroom\n\n\n      const response = await fetch('/api/classes', {\n        method: 'POST',\n        body: JSON.stringify({\n          classroomName,\n          code,\n          email\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${user.token}`\n        }\n      });\n\n      if (!response.ok) {\n        const json = await response.json();\n        setError(json.error || 'Something went wrong');\n        return; // If the class creation fails, do not proceed\n      }\n\n      const json = await response.json();\n      localStorage.setItem('class', JSON.stringify(json));\n      dispatch({\n        type: 'CREATE_CLASS',\n        payload: { ...json,\n          id: json._id\n        }\n      }); // Now try to update the code\n\n      const responseTwo = await fetch('/api/user', {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${user.token}`\n        },\n        body: JSON.stringify({\n          email: user.email,\n          code: code\n        })\n      });\n      const jsonTwo = await responseTwo.json();\n\n      if (!responseTwo.ok) {\n        throw new Error(jsonTwo.error || 'Failed to update class code');\n      }\n\n      localStorage.setItem('class', JSON.stringify(jsonTwo));\n      dispatch({\n        type: 'UPDATE_CODE',\n        payload: {\n          code: code\n        }\n      });\n      window.location.reload(); // Reload page to reflect the new class\n    } catch (error) {\n      console.error('Fetch error:', error);\n      setError('An error occurred while creating the class or updating the code.');\n    }\n  };\n\n  const openModal = () => setIsModalOpen(true);\n\n  const closeModal = () => setIsModalOpen(false);\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: openModal,\n      className: \"create-class-button\",\n      children: \"Create Class\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this), isModalOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-overlay\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-content\",\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"create-class\",\n          onSubmit: handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Create a New Class\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Class Name:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            onChange: e => setClassroomName(e.target.value),\n            value: classroomName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Class Code:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            onChange: e => setCode(e.target.value),\n            value: code\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"hidden\",\n            value: email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"submit\",\n            disabled: !classroomName || !code || !email,\n            children: \"Create Class\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 15\n          }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"error\",\n            children: error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: closeModal,\n            className: \"close-modal\",\n            children: \"Close\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\n_s(ClassroomForm, \"QE7ZLFd9RfCz+Zfycuqpgy0hXcU=\", false, function () {\n  return [useClassContext, useAuthContext];\n});\n\n_c = ClassroomForm;\nexport default ClassroomForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"ClassroomForm\");","map":{"version":3,"names":["useState","useClassContext","useAuthContext","ClassroomForm","dispatch","user","email","setEmail","code","setCode","classroomName","setClassroomName","error","setError","isModalOpen","setIsModalOpen","handleSubmit","e","preventDefault","codeExistsResponse","fetch","method","headers","token","ok","json","response","body","JSON","stringify","localStorage","setItem","type","payload","id","_id","responseTwo","jsonTwo","Error","window","location","reload","console","openModal","closeModal","target","value"],"sources":["C:/Users/alexm/VsCodeProjects/School Projects/CEN/SWE semester project/SWE-OnTask/frontend/src/components/ClassroomForm.js"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useClassContext } from \"../hooks/useClassContext\";\r\nimport { useAuthContext } from '../hooks/useAuthContext';\r\n\r\nconst ClassroomForm = () => {\r\n  const { dispatch } = useClassContext();\r\n  const { user } = useAuthContext();\r\n\r\n  const [email, setEmail] = useState(user.email);\r\n  const [code, setCode] = useState('');\r\n  const [classroomName, setClassroomName] = useState('');\r\n  const [error, setError] = useState(null);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n  \r\n    if (!user) {\r\n      setError('You must be logged in');\r\n      return;\r\n    }\r\n  \r\n    // Validate form fields\r\n    if (!classroomName || !code || !email) {\r\n      setError('Please fill in all fields');\r\n      return;\r\n    }\r\n  \r\n    try {\r\n      // Check if class code already exists\r\n      const codeExistsResponse = await fetch(`/api/classes/check-code?code=${code}`, {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${user.token}`,\r\n        },\r\n      });\r\n  \r\n      if (!codeExistsResponse.ok) {\r\n        const json = await codeExistsResponse.json();\r\n        setError(json.error || 'Class code is already taken');\r\n        return; // Prevent further execution if code exists\r\n      }\r\n  \r\n      // First, try to create the classroom\r\n      const response = await fetch('/api/classes', {\r\n        method: 'POST',\r\n        body: JSON.stringify({ classroomName, code, email }),\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${user.token}`,\r\n        },\r\n      });\r\n  \r\n      if (!response.ok) {\r\n        const json = await response.json();\r\n        setError(json.error || 'Something went wrong');\r\n        return; // If the class creation fails, do not proceed\r\n      }\r\n  \r\n      const json = await response.json();\r\n      localStorage.setItem('class', JSON.stringify(json));\r\n      dispatch({ type: 'CREATE_CLASS', payload: { ...json, id: json._id } });\r\n  \r\n      // Now try to update the code\r\n      const responseTwo = await fetch('/api/user', {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${user.token}`,\r\n        },\r\n        body: JSON.stringify({\r\n          email: user.email,\r\n          code: code,\r\n        }),\r\n      });\r\n  \r\n      const jsonTwo = await responseTwo.json();\r\n  \r\n      if (!responseTwo.ok) {\r\n        throw new Error(jsonTwo.error || 'Failed to update class code');\r\n      }\r\n  \r\n      localStorage.setItem('class', JSON.stringify(jsonTwo));\r\n      dispatch({ type: 'UPDATE_CODE', payload: { code: code } });\r\n  \r\n      window.location.reload(); // Reload page to reflect the new class\r\n  \r\n    } catch (error) {\r\n      console.error('Fetch error:', error);\r\n      setError('An error occurred while creating the class or updating the code.');\r\n    }\r\n  };\r\n  \r\n\r\n  const openModal = () => setIsModalOpen(true);\r\n  const closeModal = () => setIsModalOpen(false);\r\n\r\n  return (\r\n    <>\r\n      <button onClick={openModal} className=\"create-class-button\">Create Class</button>\r\n\r\n      {isModalOpen && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"modal-content\">\r\n            <form className=\"create-class\" onSubmit={handleSubmit}>\r\n              <h3>Create a New Class</h3>\r\n\r\n              <label>Class Name:</label>\r\n              <input\r\n                type=\"text\"\r\n                onChange={(e) => setClassroomName(e.target.value)}\r\n                value={classroomName}\r\n              />\r\n\r\n              <label>Class Code:</label>\r\n              <input\r\n                type=\"text\"\r\n                onChange={(e) => setCode(e.target.value)}\r\n                value={code}\r\n              />\r\n\r\n              <input\r\n                type=\"hidden\"\r\n                value={email}\r\n              />\r\n\r\n              <button type=\"submit\" className=\"submit\" disabled={!classroomName || !code || !email}>\r\n                Create Class\r\n              </button>\r\n              {error && <div className=\"error\">{error}</div>}\r\n\r\n              <button type=\"button\" onClick={closeModal} className=\"close-modal\">\r\n                Close\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ClassroomForm;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}